package com.example.foundusbdevice

import android.hardware.usb.UsbDevice
import android.hardware.usb.UsbManager
import android.os.Bundle
import android.util.Log
import android.view.View
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import java.util.concurrent.ExecutorService
import java.util.concurrent.Executors

class MainActivity : AppCompatActivity() {

    private var control: Control? = null
    private val service: ExecutorService = Executors.newSingleThreadExecutor()
    lateinit var device: UsbDevice


    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        findDeviceInfo()

    }

    fun usb(view: View) {
        control = UsbControl()
        Toast.makeText(this@MainActivity, "USB", Toast.LENGTH_SHORT).show()
    }

    fun connect(view: View) {
        control?.connect(this, object : ConnectCallback {
            override fun onSuccess() {
                Toast.makeText(this@MainActivity, "연결 성공", Toast.LENGTH_SHORT).show()
            }

            override fun onfailed() {
                Toast.makeText(this@MainActivity, "연결 실패", Toast.LENGTH_SHORT).show()
            }
        })
    }

    fun print(view: View) {
        service.execute(object : Thread() {
            override fun run() {
                super.run()
                control?.sendData(rv)

            }
        })
    }


    private fun findDeviceInfo() {
        val usbManager = this.getSystemService(USB_SERVICE) as UsbManager
        val deviceList = usbManager.deviceList
        val deviceIterator: Iterator<UsbDevice> = deviceList.values.iterator()
        while (deviceIterator.hasNext()) {
            val device = deviceIterator.next()
            for (i in 0 until device.interfaceCount) {
                if (device.getInterface(i).interfaceClass == 7) { //mClass가 7일 때 장비 이름 구하기
                    this.device = device
                    Log.w("USB 장비 이름 : ", device.productName.toString())
                    break
                }
            }
        }
    }


    companion object {
        private val rv = byteArrayOf(
            0x1b,
            0x40,
            0x1b,
            0x61,
            0x01,
            0x1d,
            0x21,
            0x11,
            0xa3.toByte(),
            0xa3.toByte(),
            0x31,
            0x20,
            0x20,
            0xc3.toByte(),
            0xc0.toByte(),
            0xcd.toByte(),
            0xc5.toByte(),
            0xb2.toByte(),
            0xe2.toByte(),
            0xca.toByte(),
            0xd4.toByte(),
            0x0a,
            0x0a,
            0x1d,
            0x21,
            0x00,
            0xd4.toByte(),
            0xc1.toByte(),
            0xcf.toByte(),
            0xe3.toByte(),
            0xb8.toByte(),
            0xdb.toByte(),
            0xca.toByte(),
            0xbd.toByte(),
            0xc9.toByte(),
            0xd5.toByte(),
            0xc0.toByte(),
            0xb0.toByte(),
            0x28,
            0xb5.toByte(),
            0xda.toByte(),
            0x31,
            0xc1.toByte(),
            0xaa.toByte(),
            0x29,
            0x0a,
            0x1b,
            0x21,
            0x10,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x0a,
            0x2a,
            0x20,
            0x2a,
            0x20,
            0x2a,
            0x20,
            0x2a,
            0x20,
            0x2a,
            0x20,
            0x2a,
            0x20,
            0x20,
            0xd4.toByte(),
            0xa4.toByte(),
            0xb6.toByte(),
            0xa9.toByte(),
            0xb5.toByte(),
            0xa5.toByte(),
            0x20,
            0x20,
            0x2a,
            0x20,
            0x2a,
            0x20,
            0x2a,
            0x20,
            0x2a,
            0x20,
            0x2a,
            0x20,
            0x2a,
            0x0a,
            0xc6.toByte(),
            0xda.toByte(),
            0xcd.toByte(),
            0xfb.toByte(),
            0xcb.toByte(),
            0xcd.toByte(),
            0xb4.toByte(),
            0xef.toByte(),
            0xca.toByte(),
            0xb1.toByte(),
            0xbc.toByte(),
            0xe4.toByte(),
            0x3a,
            0x20,
            0x5b,
            0x31,
            0x38,
            0x3a,
            0x30,
            0x30,
            0x5d,
            0x0a,
            0x1d,
            0x21,
            0x00,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x0a,
            0x1b,
            0x61,
            0x00,
            0xcf.toByte(),
            0xc2.toByte(),
            0xb5.toByte(),
            0xa5.toByte(),
            0xca.toByte(),
            0xb1.toByte(),
            0xbc.toByte(),
            0xe4.toByte(),
            0x3a,
            0x30,
            0x31,
            0x2d,
            0x30,
            0x31,
            0x20,
            0x31,
            0x32,
            0x3a,
            0x30,
            0x30,
            0x0a,
            0x1b,
            0x21,
            0x10,
            0xb1.toByte(),
            0xb8.toByte(),
            0xd7.toByte(),
            0xa2.toByte(),
            0x3a,
            0xb1.toByte(),
            0xf0.toByte(),
            0xcc.toByte(),
            0xab.toByte(),
            0xc0.toByte(),
            0xb1.toByte(),
            0x0a,
            0x1d,
            0x21,
            0x00,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x0a,
            0xb2.toByte(),
            0xcb.toByte(),
            0xc3.toByte(),
            0xfb.toByte(),
            0x09,
            0x09,
            0x20,
            0x20,
            0x20,
            0xca.toByte(),
            0xfd.toByte(),
            0xc1.toByte(),
            0xbf.toByte(),
            0x09,
            0x20,
            0x20,
            0x20,
            0x20,
            0xd0.toByte(),
            0xa1.toByte(),
            0xbc.toByte(),
            0xc6.toByte(),
            0x09,
            0x0a,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x0a,
            0x1b,
            0x21,
            0x10,
            0xba.toByte(),
            0xec.toByte(),
            0xc9.toByte(),
            0xd5.toByte(),
            0xc8.toByte(),
            0xe2.toByte(),
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x78,
            0x31,
            0x09,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x31,
            0x32,
            0x0a,
            0x1d,
            0x21,
            0x00,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x0a,
            0xc5.toByte(),
            0xe4.toByte(),
            0xcb.toByte(),
            0xcd.toByte(),
            0xb7.toByte(),
            0xd1.toByte(),
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x35,
            0x0a,
            0xb2.toByte(),
            0xcd.toByte(),
            0xba.toByte(),
            0xd0.toByte(),
            0xb7.toByte(),
            0xd1.toByte(),
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x31,
            0x0a,
            0x5b,
            0xb3.toByte(),
            0xac.toByte(),
            0xca.toByte(),
            0xb1.toByte(),
            0xc5.toByte(),
            0xe2.toByte(),
            0xb8.toByte(),
            0xb6.toByte(),
            0x5d,
            0x20,
            0x2d,
            0xcf.toByte(),
            0xea.toByte(),
            0xbc.toByte(),
            0xfb.toByte(),
            0xb6.toByte(),
            0xa9.toByte(),
            0xb5.toByte(),
            0xa5.toByte(),
            0x0a,
            0xbf.toByte(),
            0xc9.toByte(),
            0xbf.toByte(),
            0xda.toByte(),
            0xbf.toByte(),
            0xc9.toByte(),
            0xc0.toByte(),
            0xd6.toByte(),
            0x3a,
            0x78,
            0x31,
            0x0a,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x0a,
            0x1b,
            0x21,
            0x10,
            0xba.toByte(),
            0xcf.toByte(),
            0xbc.toByte(),
            0xc6.toByte(),
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x20,
            0x31,
            0x38,
            0xd4.toByte(),
            0xaa.toByte(),
            0x0a,
            0x1b,
            0x40,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x0a,
            0x1d,
            0x21,
            0x11,
            0xd5.toByte(),
            0xc5.toByte(),
            0x2a,
            0x20,
            0x31,
            0x38,
            0x33,
            0x31,
            0x32,
            0x33,
            0x34,
            0x35,
            0x36,
            0x37,
            0x38,
            0x0a,
            0xb5.toByte(),
            0xd8.toByte(),
            0xd6.toByte(),
            0xb7.toByte(),
            0xd0.toByte(),
            0xc5.toByte(),
            0xcf.toByte(),
            0xa2.toByte(),
            0x0a,
            0x1d,
            0x21,
            0x00,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x2d,
            0x0a,
            0x0a,
            0x1b,
            0x40,
            0x1b,
            0x61,
            0x01,
            0x1d,
            0x21,
            0x11,
            0xa3.toByte(),
            0xa3.toByte(),
            0x31,
            0x20,
            0x20,
            0xc3.toByte(),
            0xc0.toByte(),
            0xcd.toByte(),
            0xc5.toByte(),
            0xb2.toByte(),
            0xe2.toByte(),
            0xca.toByte(),
            0xd4.toByte(),
            0x0a,
            0x1d,
            0x21,
            0x00,
            0x1b,
            0x40,
            0x0a,
            0x0a,
            0x0a,
            0x0a
        )
    }

}